<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×œ×™××•×“ ×’××¨× ×•××©× ×™×•×ª - ×¢×¥ ×—×™×™×</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap');
        body { font-family: 'Heebo', sans-serif; user-select: none; }
        .page-btn { transition: all 0.1s; }
        .page-btn:active { transform: scale(0.95); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* ×× ×™××¦×™×” ×œ×¤×ª×™×—×ª ×¤×¨×§ */
        .chapter-content { transition: max-height 0.3s ease-out; overflow: hidden; max-height: 0; }
        .chapter-content.open { max-height: 500px; } /* ××¡×¤×™×§ ×’×•×‘×” ×œ×¤×¨×§ */
    </style>
</head>
<body class="bg-slate-50 text-gray-800 flex flex-col min-h-screen">
    <div id="root" class="flex-1 flex flex-col"></div>

    <script type="text/babel">
        // ==========================================
        // 1. ×”×’×“×¨×•×ª ××¢×¨×›×ª
        // ==========================================
        
        const API_URL = "https://ubriga.pythonanywhere.com"; // <--- ×©× ×” ×œ×›×ª×•×‘×ª ×©×œ×š!
        
        const { useState, useEffect, useMemo, useRef } = React;

        // ==========================================
        // 2. × ×ª×•× ×™ ×‘×¡×™×¡ ×•×¤×•× ×§×¦×™×•×ª ×¢×–×¨
        // ==========================================
        
        const getHebrewNumber = (num) => {
            if (num <= 0) return "";
            const letters = [{v:400,c:'×ª'},{v:300,c:'×©'},{v:200,c:'×¨'},{v:100,c:'×§'},{v:90,c:'×¦'},{v:80,c:'×¤'},{v:70,c:'×¢'},{v:60,c:'×¡'},{v:50,c:'× '},{v:40,c:'×'},{v:30,c:'×œ'},{v:20,c:'×›'},{v:10,c:'×™'},{v:9,c:'×˜'},{v:8,c:'×—'},{v:7,c:'×–'},{v:6,c:'×•'},{v:5,c:'×”'},{v:4,c:'×“'},{v:3,c:'×’'},{v:2,c:'×‘'},{v:1,c:'×'}];
            let str = "", temp = num;
            if (temp === 15) return "×˜×•"; if (temp === 16) return "×˜×–";
            for (let l of letters) { while(temp >= l.v) { str += l.c; temp -= l.v; } }
            return str.length === 1 ? str+"'" : str.slice(0,-1)+'"'+str.slice(-1);
        };

        // ×™×¦×™×¨×ª ×“×¤×™ ×’××¨× (×‘' ×¢"× ×•×›×•')
        const generateGemaraPages = (cnt) => {
            const p = [];
            for(let i=2; i<cnt+2; i++) {
                const h = getHebrewNumber(i);
                p.push({id:`${i}a`, label:`×“×£ ${h} ×¢"×`});
                p.push({id:`${i}b`, label:`×“×£ ${h} ×¢"×‘`});
            }
            return p;
        };

        // ×™×¦×™×¨×ª ××©× ×™×•×ª (×œ×¤×™ ×¤×¨×§×™×)
        const generateMishnayot = (chaptersArr) => {
            // chaptersArr = [9, 8, 6...] (×›××•×ª ××©× ×™×•×ª ×‘×›×œ ×¤×¨×§)
            // ×”××‘× ×” ×©×™×•×—×–×¨: ×¨×©×™××” ×©×˜×•×—×” ×©×œ ×™×—×™×“×•×ª, ××‘×œ ×¢× ××˜×-×“××˜×” ×©×œ ×¤×¨×§
            const units = [];
            chaptersArr.forEach((mishnayotCount, chapterIndex) => {
                const chapterNum = chapterIndex + 1;
                const chapterHeb = getHebrewNumber(chapterNum);
                for(let m=1; m<=mishnayotCount; m++) {
                    const mishnaHeb = getHebrewNumber(m);
                    units.push({
                        id: `p${chapterNum}_m${m}`, // ××–×”×” ×™×™×—×•×“×™: p1_m1
                        label: `××©× ×” ${mishnaHeb}`,
                        chapterTitle: `×¤×¨×§ ${chapterHeb}`,
                        chapterId: chapterNum,
                        isMishna: true
                    });
                }
            });
            return units;
        };

        // --- × ×ª×•× ×™ ×”×©"×¡ (×’××¨×) ---
        const SHAS_GEMARA_DATA = [
            { name: "×–×¨×¢×™×", books: [{n:"×‘×¨×›×•×ª",p:63}] },
            { name: "××•×¢×“", books: [{n:"×©×‘×ª",p:156},{n:"×¢×™×¨×•×‘×™×Ÿ",p:104},{n:"×¤×¡×—×™×",p:120},{n:"×©×§×œ×™×",p:21},{n:"×™×•××",p:87},{n:"×¡×•×›×”",p:55},{n:"×‘×™×¦×”",p:39},{n:"×¨××© ×”×©× ×”",p:34},{n:"×ª×¢× ×™×ª",p:30},{n:"××’×™×œ×”",p:31},{n:"××•×¢×“ ×§×˜×Ÿ",p:28},{n:"×—×’×™×’×”",p:26}] },
            { name: "× ×©×™×", books: [{n:"×™×‘××•×ª",p:121},{n:"×›×ª×•×‘×•×ª",p:111},{n:"× ×“×¨×™×",p:90},{n:"× ×–×™×¨",p:65},{n:"×¡×•×˜×”",p:48},{n:"×’×™×˜×™×Ÿ",p:89},{n:"×§×™×“×•×©×™×Ÿ",p:81}] },
            { name: "× ×–×™×§×™×Ÿ", books: [{n:"×‘×‘× ×§××",p:118},{n:"×‘×‘× ××¦×™×¢×",p:118},{n:"×‘×‘× ×‘×ª×¨×",p:175},{n:"×¡× ×”×“×¨×™×Ÿ",p:112},{n:"××›×•×ª",p:23},{n:"×©×‘×•×¢×•×ª",p:48},{n:"×¢×‘×•×“×” ×–×¨×”",p:75},{n:"×”×•×¨×™×•×ª",p:13}] },
            { name: "×§×“×©×™×", books: [{n:"×–×‘×—×™×",p:119},{n:"×× ×—×•×ª",p:109},{n:"×—×•×œ×™×Ÿ",p:141},{n:"×‘×›×•×¨×•×ª",p:60},{n:"×¢×¨×›×™×Ÿ",p:33},{n:"×ª××•×¨×”",p:33},{n:"×›×¨×™×ª×•×ª",p:27},{n:"××¢×™×œ×”",p:20},{n:"×§×™× ×™×",p:3},{n:"××™×“×•×ª",p:4},{n:"×ª××™×“",p:9}] },
            { name: "×˜×”×¨×•×ª", books: [{n:"× ×™×“×”",p:72}] }
        ];

        // --- × ×ª×•× ×™ ×”××©× ×™×•×ª (×¤×¨×§×™× ×•××©× ×™×•×ª) ---
        const MISHNA_DATA = [
            { name: "×–×¨×¢×™×", books: [
                {n:"×‘×¨×›×•×ª", c:[9,8,6,7,5,8,5,8,5]},
                {n:"×¤××”", c:[6,8,9,11,8,11,8,9]},
                {n:"×“×××™", c:[4,5,6,7,11,12,8]},
                {n:"×›×œ××™×™×", c:[9,11,7,9,8,9,8,6,10]},
                {n:"×©×‘×™×¢×™×ª", c:[8,10,10,10,9,6,7,11,9,9]},
                {n:"×ª×¨×•××•×ª", c:[10,6,9,13,9,6,7,12,7,12,10]},
                {n:"××¢×©×¨×•×ª", c:[8,8,10,6,8]},
                {n:"××¢×©×¨ ×©× ×™", c:[7,10,13,12,15]},
                {n:"×—×œ×”", c:[9,8,10,11]},
                {n:"×¢×¨×œ×”", c:[9,17,9]},
                {n:"×‘×™×›×•×¨×™×", c:[11,11,12]}
            ]},
            { name: "××•×¢×“", books: [
                {n:"×©×‘×ª", c:[11,7,6,2,4,10,2,7,7,6,6,6,7,4,3,8,8,3,6,5,3,6,5,5]},
                {n:"×¢×™×¨×•×‘×™×Ÿ", c:[10,6,9,11,9,10,11,11,4,15]},
                {n:"×¤×¡×—×™×", c:[7,8,8,9,10,6,13,8,11,9]},
                {n:"×©×§×œ×™×", c:[7,5,4,9,6,6,7,8]},
                {n:"×™×•××", c:[8,7,11,6,7,8,5,9]},
                {n:"×¡×•×›×”", c:[11,9,15,10,8]},
                {n:"×‘×™×¦×”", c:[10,10,8,7,7]},
                {n:"×¨××© ×”×©× ×”", c:[9,9,8,9]},
                {n:"×ª×¢× ×™×ª", c:[7,10,9,8]},
                {n:"××’×™×œ×”", c:[11,6,6,10]},
                {n:"××•×¢×“ ×§×˜×Ÿ", c:[10,5,9]},
                {n:"×—×’×™×’×”", c:[8,7,8]}
            ]},
            { name: "× ×©×™×", books: [
                {n:"×™×‘××•×ª", c:[4,10,10,13,6,6,6,3,6,9,7,6,13,4,10,7]},
                {n:"×›×ª×•×‘×•×ª", c:[10,10,9,12,9,7,10,8,9,6,6,4,11]},
                {n:"× ×“×¨×™×", c:[4,5,11,8,6,10,9,7,10,8,12]},
                {n:"× ×–×™×¨", c:[7,10,7,7,7,11,4,2,5]},
                {n:"×¡×•×˜×”", c:[9,6,8,5,5,4,8,7,15]},
                {n:"×’×™×˜×™×Ÿ", c:[6,7,8,9,9,7,9,10,10]},
                {n:"×§×™×“×•×©×™×Ÿ", c:[10,10,13,14]}
            ]},
            { name: "× ×–×™×§×™×Ÿ", books: [
                {n:"×‘×‘× ×§××", c:[4,6,11,9,6,6,7,7,12,10]},
                {n:"×‘×‘× ××¦×™×¢×", c:[8,11,12,12,11,8,11,9,13,6]},
                {n:"×‘×‘× ×‘×ª×¨×", c:[6,14,8,9,11,8,4,8,10,8]},
                {n:"×¡× ×”×“×¨×™×Ÿ", c:[6,5,8,5,5,6,11,7,6,6,6]},
                {n:"××›×•×ª", c:[10,8,16]},
                {n:"×©×‘×•×¢×•×ª", c:[7,5,11,13,5,7,8,6]},
                {n:"×¢×“×•×™×•×ª", c:[14,10,12,12,7,3,9,7]},
                {n:"×¢×‘×•×“×” ×–×¨×”", c:[9,7,10,12,12]},
                {n:"××‘×•×ª", c:[18,16,18,22,23]},
                {n:"×”×•×¨×™×•×ª", c:[5,7,8]}
            ]},
            { name: "×§×“×©×™×", books: [
                {n:"×–×‘×—×™×", c:[4,5,6,6,8,7,6,12,7,8,8,6,8,10]},
                {n:"×× ×—×•×ª", c:[4,5,7,5,9,7,6,7,9,9,9,5,11]},
                {n:"×—×•×œ×™×Ÿ", c:[7,10,7,7,5,7,6,6,8,4,2,5]},
                {n:"×‘×›×•×¨×•×ª", c:[7,9,4,10,6,12,7,10,8]},
                {n:"×¢×¨×›×™×Ÿ", c:[4,6,5,4,6,5,5,7,8]},
                {n:"×ª××•×¨×”", c:[6,3,5,4,6,5,6]},
                {n:"×›×¨×™×ª×•×ª", c:[7,6,10,3,8,9]},
                {n:"××¢×™×œ×”", c:[4,9,8,6,5,6]},
                {n:"×ª××™×“", c:[4,5,9,3,6,3,4]},
                {n:"××™×“×•×ª", c:[9,6,8,7,4]},
                {n:"×§×™× ×™×", c:[4,5,6]}
            ]},
            { name: "×˜×”×¨×•×ª", books: [
                {n:"×›×œ×™×", c:[9,8,8,4,11,4,6,11,8,8,9,8,8,8,6,8,17,9,10,7,3,10,5,17,9,9,12,10,8,4]},
                {n:"××”×œ×•×ª", c:[8,7,7,3,7,7,6,6,16,7,9,8,6,7,10,5,5,10]},
                {n:"× ×’×¢×™×", c:[6,5,8,11,5,8,5,10,3,10,12,7,12,13]},
                {n:"×¤×¨×”", c:[4,5,11,4,9,5,12,11,9,6,9,11]},
                {n:"×˜×”×¨×•×ª", c:[9,8,8,13,9,10,9,9,9,8]},
                {n:"××§×•×•××•×ª", c:[8,10,4,5,6,11,7,5,7,8]},
                {n:"× ×™×“×”", c:[7,7,7,7,9,14,5,4,11,8]},
                {n:"××›×©×™×¨×™×Ÿ", c:[6,11,8,10,11,8]},
                {n:"×–×‘×™×", c:[6,4,3,7,12]},
                {n:"×˜×‘×•×œ ×™×•×", c:[5,8,6,7]},
                {n:"×™×“×™×™×", c:[5,4,5,8]},
                {n:"×¢×•×§×¦×™×Ÿ", c:[6,10,12]}
            ]}
        ];

        // ×‘× ×™×™×ª ×”××¡×œ×•×œ×™×
        const TRACK_GEMARA = { 
            id: 'gemara', 
            title: '××¡×œ×•×œ ×’××¨× - ×”×©"×¡ ×”×‘×‘×œ×™', 
            sections: SHAS_GEMARA_DATA.map((s,i)=>({ 
                id: `gs_${i}`, title: s.name, 
                books: s.books.map((b,bi)=>({ 
                    id: `gb_${s.name}_${bi}`, title: `××¡×›×ª ${b.n}`, 
                    totalCount: b.p, 
                    type: 'pages',
                    units: generateGemaraPages(b.p) 
                })) 
            })) 
        };

        const TRACK_MISHNA = { 
            id: 'mishna', 
            title: '××¡×œ×•×œ ××©× ×™×•×ª - ×©×©×” ×¡×“×¨×™ ××©× ×”', 
            sections: MISHNA_DATA.map((s,i)=>({ 
                id: `ms_${i}`, title: s.name, 
                books: s.books.map((b,bi)=>({ 
                    id: `mb_${s.name}_${bi}`, title: `××¡×›×ª ${b.n}`, 
                    totalCount: b.c.reduce((a,x)=>a+x,0), // ×¡×”"×› ××©× ×™×•×ª
                    type: 'mishna',
                    units: generateMishnayot(b.c) 
                })) 
            })) 
        };

        const ALL_TRACKS = [TRACK_GEMARA, TRACK_MISHNA];

        // ==========================================
        // 3. ×§×•××¤×•× × ×˜×•×ª React
        // ==========================================

        const AdminStats = () => {
            const [stats, setStats] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetch(`${API_URL}/api/users`)
                .then(r => r.json())
                .then(async (users) => {
                    const promises = users.map(async (u) => {
                        const res = await fetch(`${API_URL}/api/get_progress?user_id=${u.id}`);
                        const data = await res.json();
                        // ×¡×¤×™×¨×” × ×¤×¨×“×ª ×œ×’××¨× ×•××©× ×”
                        const gemaraDone = data.filter(k => k.includes('gb_')).length; 
                        const mishnaDone = data.filter(k => k.includes('mb_')).length;
                        return { ...u, gemaraDone, mishnaDone };
                    });
                    const results = await Promise.all(promises);
                    setStats(results);
                    setLoading(false);
                });
            }, []);

            if (loading) return <div className="text-center p-4">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>;

            return (
                <div className="bg-white p-6 rounded-xl border shadow-sm mt-6">
                    <h2 className="text-xl font-bold mb-4">×”×ª×§×“××•×ª ×ª×œ××™×“×™×</h2>
                    <div className="overflow-x-auto">
                        <table className="w-full text-right text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="p-3">×©× ×ª×œ××™×“</th>
                                    <th className="p-3">×“×¤×™ ×’××¨×</th>
                                    <th className="p-3">××©× ×™×•×ª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {stats.map(s => (
                                    <tr key={s.id} className="border-b hover:bg-slate-50">
                                        <td className="p-3 font-medium">{s.username} <span className="text-xs text-gray-400">({s.role})</span></td>
                                        <td className="p-3 text-blue-600 font-bold">{s.gemaraDone}</td>
                                        <td className="p-3 text-emerald-600 font-bold">{s.mishnaDone}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const MishnaBookView = ({ book, progress, toggle }) => {
            // ×§×™×‘×•×¥ ×œ×¤×™ ×¤×¨×§×™×
            const chapters = useMemo(() => {
                const map = {};
                book.units.forEach(u => {
                    if(!map[u.chapterId]) map[u.chapterId] = { id: u.chapterId, title: u.chapterTitle, units: [] };
                    map[u.chapterId].units.push(u);
                });
                return Object.values(map);
            }, [book]);

            const [openChapter, setOpenChapter] = useState(null);

            const toggleChapter = (cId) => {
                setOpenChapter(openChapter === cId ? null : cId);
            };

            return (
                <div className="space-y-2">
                    {chapters.map(chapter => {
                        // ×‘×“×™×§×” ×›××” ×”×•×©×œ× ×‘×¤×¨×§
                        const completedInChapter = chapter.units.filter(u => progress[`${book.id}_${u.id}`]).length;
                        const isFull = completedInChapter === chapter.units.length;
                        const isOpen = openChapter === chapter.id;

                        return (
                            <div key={chapter.id} className="border rounded-lg bg-white overflow-hidden">
                                <button 
                                    onClick={() => toggleChapter(chapter.id)}
                                    className={`w-full flex justify-between items-center p-3 text-right font-medium hover:bg-gray-50 ${isFull ? 'bg-emerald-50 text-emerald-800' : ''}`}
                                >
                                    <span>{chapter.title}</span>
                                    <div className="flex items-center gap-2">
                                        <span className="text-xs text-gray-500">{completedInChapter}/{chapter.units.length}</span>
                                        <span className={`transform transition ${isOpen ? 'rotate-180' : ''}`}>â–¼</span>
                                    </div>
                                </button>
                                <div className={`chapter-content bg-slate-50 ${isOpen ? 'open' : ''}`}>
                                    <div className="p-3 grid grid-cols-3 sm:grid-cols-6 gap-2">
                                        {chapter.units.map(u => {
                                             const k = `${book.id}_${u.id}`; // ××™×Ÿ ×¦×•×¨×š ×‘-Track ID ×›×™ Book ID ×™×™×—×•×“×™
                                             const done = progress[k];
                                             return (
                                                <button key={u.id} onClick={() => toggle(k)} className={`p-2 rounded border text-sm ${done ? 'bg-emerald-600 text-white' : 'bg-white'}`}>
                                                    {u.label.replace('××©× ×” ','')} {done && 'âœ“'}
                                                </button>
                                             );
                                        })}
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('student');
            const [loginData, setLoginData] = useState({username:'', password:''});
            const [loginError, setLoginError] = useState('');

            const [selectedTrack, setSelectedTrack] = useState(ALL_TRACKS[0]); // ×‘×¨×™×¨×ª ××—×“×œ: ×’××¨×
            const [activeSecId, setSecId] = useState(ALL_TRACKS[0].sections[0].id);
            const [activeBookId, setBookId] = useState(ALL_TRACKS[0].sections[0].books[0].id);

            const [progress, setProgress] = useState({});
            
            // --- ×˜×¢×™× ×ª × ×ª×•× ×™× ---
            useEffect(() => {
                if (user) {
                    fetch(`${API_URL}/api/get_progress?user_id=${user.id}`).then(r=>r.json()).then(keys => {
                        const p = {}; keys.forEach(k=>p[k]=true); setProgress(p);
                    });
                }
            }, [user]);

            // --- ×œ×•×’×™×§×” ---
            const activeTrack = selectedTrack;
            const activeSec = activeTrack.sections.find(s => s.id === activeSecId) || activeTrack.sections[0];
            const activeBook = activeSec.books.find(b => b.id === activeBookId) || activeSec.books[0];

            // ×©×™× ×•×™ ××¡×œ×•×œ -> ××™×¤×•×¡ ×‘×—×™×¨×•×ª
            const changeTrack = (trackId) => {
                const newTrack = ALL_TRACKS.find(t => t.id === trackId);
                setSelectedTrack(newTrack);
                setSecId(newTrack.sections[0].id);
                setBookId(newTrack.sections[0].books[0].id);
            };

            const toggleKey = (fullKey, forceState=null) => {
                const newState = forceState !== null ? forceState : !progress[fullKey];
                setProgress(prev => ({ ...prev, [fullKey]: newState }));
                fetch(`${API_URL}/api/toggle_page`, {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({ user_id:user.id, key: fullKey, force_state: newState })
                });
            };

            // ×”×ª×××” ×œ×¤×•× ×§×¦×™×•×ª ×”×™×©× ×•×ª
            const toggleGemaraUnit = (unitId) => toggleKey(`${activeBook.id}_${unitId}`);
            
            // ×¡×˜×˜×™×¡×˜×™×§×” ×œ×‘×¨ ×”× ×•×›×—×™
            const currentBookStats = useMemo(() => {
                const total = activeBook.units.length;
                const done = activeBook.units.filter(u => progress[`${activeBook.id}_${u.id}`]).length;
                return { done, total, pct: Math.round((done/total)*100) || 0 };
            }, [progress, activeBook]);

            // ×œ×•×’×™×Ÿ
            const handleLogin = () => {
                fetch(`${API_URL}/api/login`, {
                    method: 'POST', headers:{'Content-Type':'application/json'},
                    body: JSON.stringify(loginData)
                }).then(r=>r.json()).then(d => {
                    if(d.ok) { setUser(d.user); setLoginError(''); }
                    else { setLoginError(d.error); }
                }).catch(()=>setLoginError("×©×’×™××ª ×ª×§×©×•×¨×ª"));
            };

            // ×’×¨×™×¨×” ×‘×’××¨× (×œ× ×¨×œ×•×•× ×˜×™ ×œ××©× ×™×•×ª ×›×¨×’×¢)
            const [isDragging, setIsDragging] = useState(false);
            const [dragState, setDragState] = useState(null);
            
            const handleMouseDown = (unitId, done) => {
                if(activeBook.type !== 'pages') return;
                setIsDragging(true); setDragState(!done); toggleGemaraUnit(unitId);
            };
            const handleMouseEnter = (unitId) => {
                if(isDragging && activeBook.type === 'pages') toggleKey(`${activeBook.id}_${unitId}`, dragState);
            };
            useEffect(() => {
                const up = () => setIsDragging(false);
                window.addEventListener('mouseup', up); return () => window.removeEventListener('mouseup', up);
            }, []);

            if (!user) return (
                <div className="flex flex-col min-h-screen">
                    <div className="flex-1 flex items-center justify-center bg-slate-100 p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
                            <h1 className="text-2xl font-bold mb-6 text-blue-800">××¢×¨×›×ª "×¢×¥ ×—×™×™×"</h1>
                            <input className="w-full border p-3 rounded-lg mb-3 text-right" placeholder="×©× ××©×ª××©" value={loginData.username} onChange={e=>setLoginData({...loginData, username:e.target.value})} onKeyDown={e=>e.key==='Enter'&&handleLogin()}/>
                            <input className="w-full border p-3 rounded-lg mb-3 text-right" type="password" placeholder="×¡×™×¡××”" value={loginData.password} onChange={e=>setLoginData({...loginData, password:e.target.value})} onKeyDown={e=>e.key==='Enter'&&handleLogin()}/>
                            <button onClick={handleLogin} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
                            {loginError && <p className="text-red-500 mt-4 text-sm">{loginError}</p>}
                        </div>
                    </div>
                    <footer className="bg-slate-800 text-slate-400 text-center py-4 text-xs">×¤×•×ª×— ×¢×œ ×™×“×™ OrelAI <a href="mailto:ubriga@gmail.com" className="underline">ubriga@gmail.com</a></footer>
                </div>
            );

            return (
                <div className="flex flex-col flex-1">
                    <header className="bg-white border-b sticky top-0 z-30 px-4 py-3 shadow-sm flex justify-between items-center">
                        <div>
                            <span className="font-bold text-lg text-blue-900 block">×¢×¥ ×—×™×™× LMS</span>
                            <span className="text-[10px] text-gray-400">by OrelAI</span>
                        </div>
                        <nav className="flex items-center gap-4">
                            {user.role === 'admin' && <button onClick={()=>setView(view==='admin'?'student':'admin')} className="text-sm font-bold text-blue-600">{view==='admin'?'×—×–×¨×” ×œ×œ×•××“':'×××©×§ ×× ×”×œ'}</button>}
                            <span className="text-xs font-bold bg-slate-100 px-2 py-1 rounded">{user.name}</span>
                            <button onClick={()=>setUser(null)} className="text-red-500" title="×™×¦×™××”">ğŸšª</button>
                        </nav>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 w-full flex-1">
                        {view === 'admin' ? (
                            <AdminStats />
                        ) : (
                            <div className="space-y-6">
                                {/* ×‘×—×™×¨×ª ××¡×œ×•×œ */}
                                <div className="flex justify-center gap-4">
                                    {ALL_TRACKS.map(t => (
                                        <button 
                                            key={t.id} 
                                            onClick={() => changeTrack(t.id)}
                                            className={`px-6 py-2 rounded-full font-bold transition ${selectedTrack.id === t.id ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-600 border hover:bg-gray-50'}`}
                                        >
                                            {t.title}
                                        </button>
                                    ))}
                                </div>

                                {/* ×‘×—×™×¨×ª ×¡×¤×¨ */}
                                <div className="bg-white p-4 rounded-xl border shadow-sm flex flex-col sm:flex-row gap-3 sticky top-16 z-20">
                                    <select className="border p-2 rounded-lg flex-1 bg-slate-50" value={activeSecId} onChange={e=>{
                                        const s = activeTrack.sections.find(x=>x.id===e.target.value); setSecId(s.id); setBookId(s.books[0].id);
                                    }}>
                                        {activeTrack.sections.map(s=><option key={s.id} value={s.id}>{s.title}</option>)}
                                    </select>
                                    <select className="border p-2 rounded-lg flex-1 bg-slate-50" value={activeBookId} onChange={e=>setBookId(e.target.value)}>
                                        {activeSec.books.map(b=><option key={b.id} value={b.id}>{b.title}</option>)}
                                    </select>
                                </div>

                                {/* ×¡×˜×˜×™×¡×˜×™×§×” ××§×•××™×ª */}
                                <div className="bg-white p-4 rounded-xl border flex items-center gap-4">
                                    <div className="flex-1">
                                        <div className="text-sm text-gray-500 mb-1">×”×ª×§×“××•×ª ×‘{activeBook.title}</div>
                                        <div className="w-full bg-gray-200 h-2 rounded-full"><div className={`h-2 rounded-full ${activeBook.type==='mishna'?'bg-emerald-500':'bg-blue-600'}`} style={{width:`${currentBookStats.pct}%`}}></div></div>
                                    </div>
                                    <div className="text-2xl font-bold">{currentBookStats.done}/{currentBookStats.total}</div>
                                </div>

                                {/* ××–×•×¨ ×”×ª×•×›×Ÿ ×”××©×ª× ×” */}
                                {activeBook.type === 'mishna' ? (
                                    <MishnaBookView book={activeBook} progress={progress} toggle={toggleKey} />
                                ) : (
                                    <div className="bg-white p-6 rounded-xl border shadow-sm">
                                        <div className="flex justify-between mb-4">
                                            <h2 className="font-bold text-lg">{activeBook.title}</h2>
                                            <button onClick={()=>{
                                                if(confirm("×œ×¡××Ÿ ××ª ×›×œ ×”××¡×›×ª?")) activeBook.units.forEach(u => toggleKey(`${activeBook.id}_${u.id}`, true));
                                            }} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">âœ… ×¡××Ÿ ×”×›×œ</button>
                                        </div>
                                        <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3">
                                            {activeBook.units.map(u => {
                                                const k = `${activeBook.id}_${u.id}`;
                                                const done = progress[k];
                                                return (
                                                    <button 
                                                        key={u.id} 
                                                        onMouseDown={()=>handleMouseDown(u.id, done)}
                                                        onMouseEnter={()=>handleMouseEnter(u.id)}
                                                        className={`page-btn p-3 rounded-lg border text-sm font-medium ${done ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-slate-50 text-gray-600 hover:border-blue-400'}`}
                                                    >
                                                        {u.label} {done && "âœ“"}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    <footer className="bg-slate-800 text-slate-400 text-center py-4 text-xs">×¤×•×ª×— ×¢×œ ×™×“×™ OrelAI <a href="mailto:ubriga@gmail.com" className="underline">ubriga@gmail.com</a></footer>
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
