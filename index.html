<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×œ×™××•×“ ×’××¨× ×•××©× ×™×•×ª - ×¢×¥ ×—×™×™×</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Recaptcha V3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LdspWUsAAAAAGvDPcxbJWJDxVPWelRYNVQrKrv7"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&family=David+Libre:wght@400;700&family=Frank+Ruhl+Libre:wght@300;400;700&display=swap');
        body { font-family: 'Heebo', sans-serif; user-select: none; }
        .page-btn { transition: all 0.1s; }
        .page-btn:active { transform: scale(0.95); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .chapter-content { transition: max-height 0.3s ease-out; overflow: hidden; max-height: 0; }
        .chapter-content.open { max-height: 1000px; }
        @keyframes candle-flicker {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.95); }
        }
        .candle-flame { animation: candle-flicker 2s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-50 text-gray-800 flex flex-col min-h-screen">
    <div id="root" class="flex-1 flex flex-col"></div>

    <script type="text/babel" data-presets="react">
        const API_URL = "https://ubriga.pythonanywhere.com";
        const RECAPTCHA_SITE_KEY = "6LdspWUsAAAAAGvDPcxbJWJDxVPWelRYNVQrKrv7";

        const { useState, useEffect, useMemo } = React;

        // --- ×¢×–×¨×™× ---
        const getHebrewNumber = (num) => {
            if (num <= 0) return "";
            const letters = [{v:400,c:'×ª'},{v:300,c:'×©'},{v:200,c:'×¨'},{v:100,c:'×§'},{v:90,c:'×¦'},{v:80,c:'×¤'},{v:70,c:'×¢'},{v:60,c:'×¡'},{v:50,c:'× '},{v:40,c:'×'},{v:30,c:'×œ'},{v:20,c:'×›'},{v:10,c:'×™'},{v:9,c:'×˜'},{v:8,c:'×—'},{v:7,c:'×–'},{v:6,c:'×•'},{v:5,c:'×”'},{v:4,c:'×“'},{v:3,c:'×’'},{v:2,c:'×‘'},{v:1,c:'×'}];
            let str = "", temp = num;
            if (temp === 15) return "×˜×•"; if (temp === 16) return "×˜×–";
            for (let l of letters) { while(temp >= l.v) { str += l.c; temp -= l.v; } }
            return str.length === 1 ? str+"'" : str.slice(0,-1)+'"'+str.slice(-1);
        };

        const generateGemaraPages = (cnt) => {
            const p = [];
            for(let i=2; i<cnt+2; i++) {
                const h = getHebrewNumber(i);
                p.push({id:`${i}a`, label:`×“×£ ${h} ×¢"×`});
                p.push({id:`${i}b`, label:`×“×£ ${h} ×¢"×‘`});
            }
            return p;
        };

        const generateMishnayot = (chaptersArr) => {
            const units = [];
            chaptersArr.forEach((count, idx) => {
                const cNum = idx + 1;
                const cHeb = getHebrewNumber(cNum);
                for(let m=1; m<=count; m++) {
                    units.push({
                        id: `p${cNum}_m${m}`,
                        label: `××©× ×” ${getHebrewNumber(m)}`,
                        chapterTitle: `×¤×¨×§ ${cHeb}`,
                        chapterId: cNum,
                        isMishna: true
                    });
                }
            });
            return units;
        };

        // --- × ×ª×•× ×™× ×¢× ××–×”×™× ×§×‘×•×¢×™× ×œ×× ×™×¢×ª ××™×‘×•×“ ××™×“×¢ ---
        const SHAS_GEMARA_DATA = [{"name": "×–×¨×¢×™×", "books": [{"n": "×‘×¨×›×•×ª", "p": 63, "id": "0"}], "id": "×–×¨×¢×™×"}, {"name": "××•×¢×“", "books": [{"n": "×©×‘×ª", "p": 156, "id": "0"}, {"n": "×¢×™×¨×•×‘×™×Ÿ", "p": 104, "id": "1"}, {"n": "×¤×¡×—×™×", "p": 120, "id": "2"}, {"n": "×©×§×œ×™×", "p": 21, "id": "3"}, {"n": "×™×•××", "p": 87, "id": "4"}, {"n": "×¡×•×›×”", "p": 55, "id": "5"}, {"n": "×‘×™×¦×”", "p": 39, "id": "6"}, {"n": "×¨××© ×”×©× ×”", "p": 34, "id": "7"}, {"n": "×ª×¢× ×™×ª", "p": 30, "id": "8"}, {"n": "××’×™×œ×”", "p": 31, "id": "9"}, {"n": "××•×¢×“ ×§×˜×Ÿ", "p": 28, "id": "10"}, {"n": "×—×’×™×’×”", "p": 26, "id": "11"}], "id": "××•×¢×“"}, {"name": "× ×©×™×", "books": [{"n": "×™×‘××•×ª", "p": 121, "id": "0"}, {"n": "×›×ª×•×‘×•×ª", "p": 111, "id": "1"}, {"n": "× ×“×¨×™×", "p": 90, "id": "2"}, {"n": "× ×–×™×¨", "p": 65, "id": "3"}, {"n": "×¡×•×˜×”", "p": 48, "id": "4"}, {"n": "×’×™×˜×™×Ÿ", "p": 89, "id": "5"}, {"n": "×§×™×“×•×©×™×Ÿ", "p": 81, "id": "6"}], "id": "× ×©×™×"}, {"name": "× ×–×™×§×™×Ÿ", "books": [{"n": "×‘×‘× ×§××", "p": 118, "id": "0"}, {"n": "×‘×‘× ××¦×™×¢×", "p": 118, "id": "1"}, {"n": "×‘×‘× ×‘×ª×¨×", "p": 175, "id": "2"}, {"n": "×¡× ×”×“×¨×™×Ÿ", "p": 112, "id": "3"}, {"n": "××›×•×ª", "p": 23, "id": "4"}, {"n": "×©×‘×•×¢×•×ª", "p": 48, "id": "5"}, {"n": "×¢×‘×•×“×” ×–×¨×”", "p": 75, "id": "6"}, {"n": "×”×•×¨×™×•×ª", "p": 13, "id": "7"}], "id": "× ×–×™×§×™×Ÿ"}, {"name": "×§×“×©×™×", "books": [{"n": "×–×‘×—×™×", "p": 119, "id": "0"}, {"n": "×× ×—×•×ª", "p": 109, "id": "1"}, {"n": "×—×•×œ×™×Ÿ", "p": 141, "id": "2"}, {"n": "×‘×›×•×¨×•×ª", "p": 60, "id": "3"}, {"n": "×¢×¨×›×™×Ÿ", "p": 33, "id": "4"}, {"n": "×ª××•×¨×”", "p": 33, "id": "5"}, {"n": "×›×¨×™×ª×•×ª", "p": 27, "id": "6"}, {"n": "××¢×™×œ×”", "p": 20, "id": "7"}, {"n": "×§×™× ×™×", "p": 3, "id": "8"}, {"n": "××™×“×•×ª", "p": 4, "id": "9"}, {"n": "×ª××™×“", "p": 9, "id": "10"}], "id": "×§×“×©×™×"}, {"name": "×˜×”×¨×•×ª", "books": [{"n": "× ×™×“×”", "p": 72, "id": "0"}], "id": "×˜×”×¨×•×ª"}];

        const MISHNA_DATA = [{"name": "×–×¨×¢×™×", "books": [{"n": "×‘×¨×›×•×ª", "c": [9, 8, 6, 7, 5, 8, 5, 8, 5], "id": "0"}, {"n": "×¤××”", "c": [6, 8, 9, 11, 8, 11, 8, 9], "id": "1"}, {"n": "×“×××™", "c": [4, 5, 6, 7, 11, 12, 8], "id": "2"}, {"n": "×›×œ××™×™×", "c": [9, 11, 7, 9, 8, 9, 8, 6, 10], "id": "3"}, {"n": "×©×‘×™×¢×™×ª", "c": [8, 10, 10, 10, 9, 6, 7, 11, 9, 9], "id": "4"}, {"n": "×ª×¨×•××•×ª", "c": [10, 6, 9, 13, 9, 6, 7, 12, 7, 12, 10], "id": "5"}, {"n": "××¢×©×¨×•×ª", "c": [8, 8, 10, 6, 8], "id": "6"}, {"n": "××¢×©×¨ ×©× ×™", "c": [7, 10, 13, 12, 15], "id": "7"}, {"n": "×—×œ×”", "c": [9, 8, 10, 11], "id": "8"}, {"n": "×¢×¨×œ×”", "c": [9, 17, 9], "id": "9"}, {"n": "×‘×™×›×•×¨×™×", "c": [11, 11, 12], "id": "10"}], "id": "×–×¨×¢×™×"}, {"name": "××•×¢×“", "books": [{"n": "×©×‘×ª", "c": [11, 7, 6, 2, 4, 10, 2, 7, 7, 6, 6, 6, 7, 4, 3, 8, 8, 3, 6, 5, 3, 6, 5, 5], "id": "0"}, {"n": "×¢×™×¨×•×‘×™×Ÿ", "c": [10, 6, 9, 11, 9, 10, 11, 11, 4, 15], "id": "1"}, {"n": "×¤×¡×—×™×", "c": [7, 8, 8, 9, 10, 6, 13, 8, 11, 9], "id": "2"}, {"n": "×©×§×œ×™×", "c": [7, 5, 4, 9, 6, 6, 7, 8], "id": "3"}, {"n": "×™×•××", "c": [8, 7, 11, 6, 7, 8, 5, 9], "id": "4"}, {"n": "×¡×•×›×”", "c": [11, 9, 15, 10, 8], "id": "5"}, {"n": "×‘×™×¦×”", "c": [10, 10, 8, 7, 7], "id": "6"}, {"n": "×¨××© ×”×©× ×”", "c": [9, 9, 8, 9], "id": "7"}, {"n": "×ª×¢× ×™×ª", "c": [7, 10, 9, 8], "id": "8"}, {"n": "××’×™×œ×”", "c": [11, 6, 6, 10], "id": "9"}, {"n": "××•×¢×“ ×§×˜×Ÿ", "c": [10, 5, 9], "id": "10"}, {"n": "×—×’×™×’×”", "c": [8, 7, 8], "id": "11"}], "id": "××•×¢×“"}, {"name": "× ×©×™×", "books": [{"n": "×™×‘××•×ª", "c": [4, 10, 10, 13, 6, 6, 6, 3, 6, 9, 7, 6, 13, 4, 10, 7], "id": "0"}, {"n": "×›×ª×•×‘×•×ª", "c": [10, 10, 9, 12, 9, 7, 10, 8, 9, 6, 6, 4, 11], "id": "1"}, {"n": "× ×“×¨×™×", "c": [4, 5, 11, 8, 6, 10, 9, 7, 10, 8, 12], "id": "2"}, {"n": "× ×–×™×¨", "c": [7, 10, 7, 7, 7, 11, 4, 2, 5], "id": "3"}, {"n": "×¡×•×˜×”", "c": [9, 6, 8, 5, 5, 4, 8, 7, 15], "id": "4"}, {"n": "×’×™×˜×™×Ÿ", "c": [6, 7, 8, 9, 9, 7, 9, 10, 10], "id": "5"}, {"n": "×§×™×“×•×©×™×Ÿ", "c": [10, 10, 13, 14], "id": "6"}], "id": "× ×©×™×"}, {"name": "× ×–×™×§×™×Ÿ", "books": [{"n": "×‘×‘× ×§××", "c": [4, 6, 11, 9, 6, 6, 7, 7, 12, 10], "id": "0"}, {"n": "×‘×‘× ××¦×™×¢×", "c": [8, 11, 12, 12, 11, 8, 11, 9, 13, 6], "id": "1"}, {"n": "×‘×‘× ×‘×ª×¨×", "c": [6, 14, 8, 9, 11, 8, 4, 8, 10, 8], "id": "2"}, {"n": "×¡× ×”×“×¨×™×Ÿ", "c": [6, 5, 8, 5, 5, 6, 11, 7, 6, 6, 6], "id": "3"}, {"n": "××›×•×ª", "c": [10, 8, 16], "id": "4"}, {"n": "×©×‘×•×¢×•×ª", "c": [7, 5, 11, 13, 5, 7, 8, 6], "id": "5"}, {"n": "×¢×“×•×™×•×ª", "c": [14, 10, 12, 12, 7, 3, 9, 7], "id": "6"}, {"n": "×¢×‘×•×“×” ×–×¨×”", "c": [9, 7, 10, 12, 12], "id": "7"}, {"n": "××‘×•×ª", "c": [18, 16, 18, 22, 23], "id": "8"}, {"n": "×”×•×¨×™×•×ª", "c": [5, 7, 8], "id": "9"}], "id": "× ×–×™×§×™×Ÿ"}, {"name": "×§×“×©×™×", "books": [{"n": "×–×‘×—×™×", "c": [4, 5, 6, 6, 8, 7, 6, 12, 7, 8, 8, 6, 8, 10], "id": "0"}, {"n": "×× ×—×•×ª", "c": [4, 5, 7, 5, 9, 7, 6, 7, 9, 9, 9, 5, 11], "id": "1"}, {"n": "×—×•×œ×™×Ÿ", "c": [7, 10, 7, 7, 5, 7, 6, 6, 8, 4, 2, 5], "id": "2"}, {"n": "×‘×›×•×¨×•×ª", "c": [7, 9, 4, 10, 6, 12, 7, 10, 8], "id": "3"}, {"n": "×¢×¨×›×™×Ÿ", "c": [4, 6, 5, 4, 6, 5, 5, 7, 8], "id": "4"}, {"n": "×ª××•×¨×”", "c": [6, 3, 5, 4, 6, 5, 6], "id": "5"}, {"n": "×›×¨×™×ª×•×ª", "c": [7, 6, 10, 3, 8, 9], "id": "6"}, {"n": "××¢×™×œ×”", "c": [4, 9, 8, 6, 5, 6], "id": "7"}, {"n": "×ª××™×“", "c": [4, 5, 9, 3, 6, 3, 4], "id": "8"}, {"n": "××™×“×•×ª", "c": [9, 6, 8, 7, 4], "id": "9"}, {"n": "×§×™× ×™×", "c": [4, 5, 6], "id": "10"}], "id": "×§×“×©×™×"}, {"name": "×˜×”×¨×•×ª", "books": [{"n": "×›×œ×™×", "c": [9, 8, 8, 4, 11, 4, 6, 11, 8, 8, 9, 8, 8, 8, 6, 8, 17, 9, 10, 7, 3, 10, 5, 17, 9, 9, 12, 10, 8, 4], "id": "0"}, {"n": "××”×œ×•×ª", "c": [8, 7, 7, 3, 7, 7, 6, 6, 16, 7, 9, 8, 6, 7, 10, 5, 5, 10], "id": "1"}, {"n": "× ×’×¢×™×", "c": [6, 5, 8, 11, 5, 8, 5, 10, 3, 10, 12, 7, 12, 13], "id": "2"}, {"n": "×¤×¨×”", "c": [4, 5, 11, 4, 9, 5, 12, 11, 9, 6, 9, 11], "id": "3"}, {"n": "×˜×”×¨×•×ª", "c": [9, 8, 8, 13, 9, 10, 9, 9, 9, 8], "id": "4"}, {"n": "××§×•×•××•×ª", "c": [8, 10, 4, 5, 6, 11, 7, 5, 7, 8], "id": "5"}, {"n": "× ×™×“×”", "c": [7, 7, 7, 7, 9, 14, 5, 4, 11, 8], "id": "6"}, {"n": "××›×©×™×¨×™×Ÿ", "c": [6, 11, 8, 10, 11, 8], "id": "7"}, {"n": "×–×‘×™×", "c": [6, 4, 3, 7, 12], "id": "8"}, {"n": "×˜×‘×•×œ ×™×•×", "c": [5, 8, 6, 7], "id": "9"}, {"n": "×™×“×™×™×", "c": [5, 4, 5, 8], "id": "10"}, {"n": "×¢×•×§×¦×™×Ÿ", "c": [6, 10, 12], "id": "11"}], "id": "×˜×”×¨×•×ª"}];

        // ×‘× ×™×™×ª ××¡×œ×•×œ×™× ×¢× ×©×™××•×© ×‘-ID ×”×§×‘×•×¢
        const TRACK_GEMARA = { 
            id: 'gemara', 
            title: '×’××¨× (×©"×¡ ×‘×‘×œ×™)', 
            sections: SHAS_GEMARA_DATA.map((s,i)=>({ 
                id: `gs_${i}`,
                title: s.name, 
                books: s.books.map((b,bi)=>({ 
                    id: `gb_${s.id}_${b.id}`,
                    title: `××¡×›×ª ${b.n}`, 
                    totalCount: b.p * 2, 
                    type: 'pages', 
                    units: generateGemaraPages(b.p) 
                })) 
            })) 
        };
        
        const TRACK_MISHNA = { 
            id: 'mishna', 
            title: '×©×©×” ×¡×“×¨×™ ××©× ×”', 
            sections: MISHNA_DATA.map((s,i)=>({ 
                id: `ms_${i}`, 
                title: s.name, 
                books: s.books.map((b,bi)=>({ 
                    id: `mb_${s.id}_${b.id}`,
                    title: `××¡×›×ª ${b.n}`, 
                    totalCount: b.c.reduce((a,x)=>a+x,0), 
                    type: 'mishna', 
                    units: generateMishnayot(b.c) 
                })) 
            })) 
        };
        
        const ALL_TRACKS = [TRACK_GEMARA, TRACK_MISHNA];

        // ×—×™×©×•×‘ ×¡×”"×› ×’×œ×•×‘×œ×™ ×œ×›×œ ××¡×œ×•×œ
        const GEMARA_TOTAL = TRACK_GEMARA.sections.reduce((acc,s)=> acc + s.books.reduce((bAcc,b)=> bAcc + b.totalCount, 0), 0);
        const MISHNA_TOTAL = TRACK_MISHNA.sections.reduce((acc,s)=> acc + s.books.reduce((bAcc,b)=> bAcc + b.totalCount, 0), 0);

        // --- ×§×•××¤×•× × ×˜ ×”×§×“×©×•×ª ---

        const DedicationsDisplay = () => {
            const [dedications, setDedications] = useState([]);

            useEffect(() => {
                fetch(`${API_URL}/api/dedications`)
                    .then(r => r.json())
                    .then(setDedications)
                    .catch(() => {});
            }, []);

            if (dedications.length === 0) return null;

            const neshamot = dedications.filter(d => d.type === 'neshama');
            const refuot = dedications.filter(d => d.type === 'refua');

            return (
                <div className="w-full max-w-4xl mx-auto mb-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {neshamot.length > 0 && (
                            <div className="bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-5 shadow-lg">
                                <div className="flex items-center gap-3 mb-4 border-b border-amber-300 pb-3">
                                    <div className="text-3xl candle-flame">ğŸ•¯ï¸</div>
                                    <h3 className="text-lg font-bold text-amber-900">×œ×¢×™×œ×•×™ × ×©××ª</h3>
                                </div>
                                <div className="space-y-3">
                                    {neshamot.map(d => (
                                        <div key={d.id} className="bg-white/60 rounded-lg p-3" style={{
                                            fontFamily: d.font,
                                            fontSize: `${d.font_size}px`,
                                            fontWeight: d.bold ? 'bold' : 'normal',
                                            fontStyle: d.italic ? 'italic' : 'normal',
                                            textDecoration: d.underline ? 'underline' : 'none',
                                            color: d.color,
                                            textAlign: d.align
                                        }}>
                                            {d.content}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {refuot.length > 0 && (
                            <div className="bg-gradient-to-br from-blue-50 to-cyan-50 border-2 border-blue-200 rounded-2xl p-5 shadow-lg">
                                <div className="flex items-center gap-3 mb-4 border-b border-blue-300 pb-3">
                                    <div className="text-3xl">âœ¡ï¸</div>
                                    <h3 className="text-lg font-bold text-blue-900">×œ×¨×¤×•××ª</h3>
                                </div>
                                <div className="space-y-3">
                                    {refuot.map(d => (
                                        <div key={d.id} className="bg-white/60 rounded-lg p-3" style={{
                                            fontFamily: d.font,
                                            fontSize: `${d.font_size}px`,
                                            fontWeight: d.bold ? 'bold' : 'normal',
                                            fontStyle: d.italic ? 'italic' : 'normal',
                                            textDecoration: d.underline ? 'underline' : 'none',
                                            color: d.color,
                                            textAlign: d.align
                                        }}>
                                            {d.content}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="text-center mt-4 text-sm text-gray-600">
                        ×œ×˜×•×‘×ª ×”×§×“×©×•×ª ×™×© ×œ×¤× ×•×ª ×œ-<a href="mailto:ubriga@gmail.com" className="text-blue-600 underline font-bold">ubriga@gmail.com</a>
                    </div>
                </div>
            );
        };

        // --- × ×™×”×•×œ ×”×§×“×©×•×ª (××“××™×Ÿ) ---

        const AdminDedications = () => {
            const [dedications, setDedications] = useState([]);
            const [form, setForm] = useState({
                type: 'neshama',
                content: '',
                font: 'Heebo',
                font_size: 16,
                bold: false,
                italic: false,
                underline: false,
                color: '#000000',
                align: 'right',
                end_date: ''
            });

            const fetchDedications = () => {
                fetch(`${API_URL}/api/dedications/all`)
                    .then(r => r.json())
                    .then(setDedications);
            };

            useEffect(() => { fetchDedications(); }, []);

            const handleSubmit = () => {
                if (!form.content || !form.end_date) {
                    alert('×™×© ×œ××œ× ×ª×•×›×Ÿ ×•×ª××¨×™×š ×¡×™×•×');
                    return;
                }

                fetch(`${API_URL}/api/dedications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(form)
                })
                .then(r => r.json())
                .then(data => {
                    if (data.ok) {
                        alert('×”×§×“×©×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
                        setForm({
                            type: 'neshama',
                            content: '',
                            font: 'Heebo',
                            font_size: 16,
                            bold: false,
                            italic: false,
                            underline: false,
                            color: '#000000',
                            align: 'right',
                            end_date: ''
                        });
                        fetchDedications();
                    } else {
                        alert('×©×’×™××”: ' + data.error);
                    }
                });
            };

            const handleDelete = (id) => {
                if (!confirm('×”×× ×œ××—×•×§ ×”×§×“×©×” ×–×•?')) return;
                
                fetch(`${API_URL}/api/dedications/${id}`, { method: 'DELETE' })
                    .then(r => r.json())
                    .then(data => {
                        if (data.ok) {
                            alert('×”×§×“×©×” × ××—×§×”');
                            fetchDedications();
                        }
                    });
            };

            return (
                <div className="bg-white p-6 rounded-xl border shadow-sm mt-6">
                    <h2 className="text-xl font-bold mb-4">× ×™×”×•×œ ×”×§×“×©×•×ª</h2>
                    
                    <div className="bg-slate-50 p-5 rounded-lg mb-6">
                        <h3 className="font-bold mb-3">×”×•×¡×¤×ª ×”×§×“×©×” ×—×“×©×”</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-bold mb-1">×¡×•×’ ×”×§×“×©×”</label>
                                <select className="w-full border p-2 rounded" value={form.type} onChange={e => setForm({...form, type: e.target.value})}>
                                    <option value="neshama">×œ×¢×™×œ×•×™ × ×©××ª</option>
                                    <option value="refua">×œ×¨×¤×•××ª</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-bold mb-1">×ª××¨×™×š ×•×–××Ÿ ×¡×™×•×</label>
                                <input type="datetime-local" className="w-full border p-2 rounded" value={form.end_date} onChange={e => setForm({...form, end_date: e.target.value})} />
                            </div>
                        </div>
                        
                        <div className="mt-4">
                            <label className="block text-sm font-bold mb-1">×ª×•×›×Ÿ ×”×”×§×“×©×”</label>
                            <textarea className="w-full border p-2 rounded" rows="3" value={form.content} onChange={e => setForm({...form, content: e.target.value})} placeholder="×”×–×Ÿ ××ª ×ª×•×›×Ÿ ×”×”×§×“×©×”..."></textarea>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                            <div>
                                <label className="block text-sm font-bold mb-1">×¤×•× ×˜</label>
                                <select className="w-full border p-2 rounded" value={form.font} onChange={e => setForm({...form, font: e.target.value})}>
                                    <option value="Heebo">Heebo</option>
                                    <option value="David Libre">David Libre</option>
                                    <option value="Frank Ruhl Libre">Frank Ruhl Libre</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-bold mb-1">×’×•×“×œ</label>
                                <input type="number" className="w-full border p-2 rounded" value={form.font_size} onChange={e => setForm({...form, font_size: parseInt(e.target.value)})} min="10" max="48" />
                            </div>
                            <div>
                                <label className="block text-sm font-bold mb-1">×¦×‘×¢</label>
                                <input type="color" className="w-full border p-2 rounded h-10" value={form.color} onChange={e => setForm({...form, color: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-bold mb-1">×™×™×©×•×¨</label>
                                <select className="w-full border p-2 rounded" value={form.align} onChange={e => setForm({...form, align: e.target.value})}>
                                    <option value="right">×™××™×Ÿ</option>
                                    <option value="center">××¨×›×–</option>
                                    <option value="left">×©×××œ</option>
                                </select>
                            </div>
                        </div>

                        <div className="flex gap-3 mt-4">
                            <label className="flex items-center gap-2">
                                <input type="checkbox" checked={form.bold} onChange={e => setForm({...form, bold: e.target.checked})} />
                                <span className="font-bold">Bold</span>
                            </label>
                            <label className="flex items-center gap-2">
                                <input type="checkbox" checked={form.italic} onChange={e => setForm({...form, italic: e.target.checked})} />
                                <span className="italic">Italic</span>
                            </label>
                            <label className="flex items-center gap-2">
                                <input type="checkbox" checked={form.underline} onChange={e => setForm({...form, underline: e.target.checked})} />
                                <span className="underline">Underline</span>
                            </label>
                        </div>

                        <div className="mt-4 p-3 bg-white rounded border" style={{
                            fontFamily: form.font,
                            fontSize: `${form.font_size}px`,
                            fontWeight: form.bold ? 'bold' : 'normal',
                            fontStyle: form.italic ? 'italic' : 'normal',
                            textDecoration: form.underline ? 'underline' : 'none',
                            color: form.color,
                            textAlign: form.align
                        }}>
                            {form.content || '×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”×”×§×“×©×”...'}
                        </div>

                        <button onClick={handleSubmit} className="mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 font-bold">×”×•×¡×£ ×”×§×“×©×”</button>
                    </div>

                    <div>
                        <h3 className="font-bold mb-3">×”×§×“×©×•×ª ×§×™×™××•×ª</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-right">
                                <thead className="bg-gray-100">
                                    <tr>
                                        <th className="p-2">×¡×•×’</th>
                                        <th className="p-2">×ª×•×›×Ÿ</th>
                                        <th className="p-2">× ×•×¦×¨</th>
                                        <th className="p-2">×ª××¨×™×š ×¡×™×•×</th>
                                        <th className="p-2">×”×¡×ª×™×™×</th>
                                        <th className="p-2">×¡×˜×˜×•×¡</th>
                                        <th className="p-2">×¤×¢×•×œ×•×ª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {dedications.map(d => (
                                        <tr key={d.id} className="border-b">
                                            <td className="p-2">{d.type === 'neshama' ? 'ğŸ•¯ï¸ × ×©××”' : 'âœ¡ï¸ ×¨×¤×•××”'}</td>
                                            <td className="p-2 max-w-xs truncate">{d.content}</td>
                                            <td className="p-2 text-xs">{new Date(d.created_at).toLocaleString('he-IL')}</td>
                                            <td className="p-2 text-xs">{new Date(d.end_date).toLocaleString('he-IL')}</td>
                                            <td className="p-2 text-xs">{d.ended_at ? new Date(d.ended_at).toLocaleString('he-IL') : '-'}</td>
                                            <td className="p-2">
                                                <span className={`px-2 py-1 rounded text-xs ${d.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}`}>
                                                    {d.is_active ? '×¤×¢×™×œ' : '×¤×’ ×ª×•×§×£'}
                                                </span>
                                            </td>
                                            <td className="p-2">
                                                <button onClick={() => handleDelete(d.id)} className="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ×§×•××¤×•× × ×˜×•×ª ××“××™×Ÿ ---

        const AdminUserManagement = ({ users, fetchUsers }) => {
            const [formData, setForm] = useState({username:'', password:'', role:'student'});
            
            const addUser = () => {
                if(!formData.username || !formData.password) return;
                fetch(`${API_URL}/api/users`, {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body: JSON.stringify(formData)
                }).then(r=>r.json()).then(d => {
                    if(d.ok) {
                        alert("××©×ª××© × ×•×¡×£ ×‘×”×¦×œ×—×”!");
                        setForm({username:'', password:'', role:'student'});
                        fetchUsers();
                    } else { alert(d.error); }
                });
            };

            return (
                <div className="bg-white p-6 rounded-xl border shadow-sm mt-6">
                    <h2 className="text-xl font-bold mb-4">× ×™×”×•×œ ××©×ª××©×™×</h2>
                    <div className="flex flex-col md:flex-row gap-3 mb-6 bg-slate-50 p-4 rounded-lg">
                        <input className="border p-2 rounded flex-1" placeholder="×©× ××©×ª××©" value={formData.username} onChange={e=>setForm({...formData, username:e.target.value})} />
                        <input className="border p-2 rounded flex-1" placeholder="×¡×™×¡××”" type="password" value={formData.password} onChange={e=>setForm({...formData, password:e.target.value})} />
                        <select className="border p-2 rounded" value={formData.role} onChange={e=>setForm({...formData, role:e.target.value})}>
                            <option value="student">×ª×œ××™×“</option>
                            <option value="group_admin">×× ×”×œ ×§×‘×•×¦×”</option>
                            <option value="admin">××“××™×Ÿ ×¨××©×™</option>
                        </select>
                        <button onClick={addUser} className="bg-emerald-600 text-white px-6 py-2 rounded hover:bg-emerald-700 font-bold">+</button>
                    </div>
                    <table className="w-full text-right text-sm">
                        <thead className="bg-gray-100"><tr><th className="p-2">ID</th><th className="p-2">×©×</th><th className="p-2">×ª×¤×§×™×“</th></tr></thead>
                        <tbody>
                            {users.map(u => <tr key={u.id} className="border-b"><td className="p-2">{u.id}</td><td className="p-2 font-bold">{u.username}</td><td className="p-2">{u.role}</td></tr>)}
                        </tbody>
                    </table>
                </div>
            );
        };

        const AdminStats = () => {
            const [stats, setStats] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetch(`${API_URL}/api/users`).then(r => r.json()).then(async (users) => {
                    const promises = users.map(async (u) => {
                        const res = await fetch(`${API_URL}/api/get_progress?user_id=${u.id}`);
                        const data = await res.json();
                        const gemaraDone = data.filter(k => k.includes('gb_')).length;
                        const mishnaDone = data.filter(k => k.includes('mb_')).length;
                        return { ...u, gemaraDone, mishnaDone };
                    });
                    const results = await Promise.all(promises);
                    setStats(results);
                    setLoading(false);
                });
            }, []);

            if (loading) return <div className="text-center p-4">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>;

            return (
                <div className="bg-white p-6 rounded-xl border shadow-sm mt-6">
                    <h2 className="text-xl font-bold mb-4">×“×•×—×•×ª ×”×ª×§×“××•×ª</h2>
                    <div className="overflow-x-auto">
                        <table className="w-full text-right text-sm border-collapse">
                            <thead className="bg-gray-100 text-gray-700">
                                <tr>
                                    <th className="p-3">×©× ×ª×œ××™×“</th>
                                    <th className="p-3 border-r">×’××¨× (×“×¤×™×)</th>
                                    <th className="p-3">×¡×™×•× ×©"×¡ ×’××¨×</th>
                                    <th className="p-3 border-r">××©× ×™×•×ª (×™×—×™×“×•×ª)</th>
                                    <th className="p-3">×¡×™×•× ×©"×¡ ××©× ×™×•×ª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {stats.map(s => {
                                    const gemaraPct = ((s.gemaraDone / GEMARA_TOTAL) * 100).toFixed(1);
                                    const mishnaPct = ((s.mishnaDone / MISHNA_TOTAL) * 100).toFixed(1);
                                    return (
                                        <tr key={s.id} className="border-b hover:bg-slate-50">
                                            <td className="p-3 font-medium">{s.username} <span className="text-xs text-gray-400">({s.role})</span></td>
                                            <td className="p-3 border-r text-blue-600 font-bold">{s.gemaraDone}</td>
                                            <td className="p-3">
                                                <div className="flex items-center gap-2 w-32">
                                                    <div className="flex-1 bg-gray-200 h-2 rounded-full"><div className="bg-blue-600 h-2 rounded-full" style={{width:`${Math.min(gemaraPct,100)}%`}}></div></div>
                                                    <span className="text-xs w-8">{gemaraPct}%</span>
                                                </div>
                                            </td>
                                            <td className="p-3 border-r text-emerald-600 font-bold">{s.mishnaDone}</td>
                                            <td className="p-3">
                                                <div className="flex items-center gap-2 w-32">
                                                    <div className="flex-1 bg-gray-200 h-2 rounded-full"><div className="bg-emerald-500 h-2 rounded-full" style={{width:`${Math.min(mishnaPct,100)}%`}}></div></div>
                                                    <span className="text-xs w-8">{mishnaPct}%</span>
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const AdminPanel = () => {
            const [tab, setTab] = useState('stats');
            const [users, setUsers] = useState([]);

            const fetchUsers = () => fetch(`${API_URL}/api/users`).then(r=>r.json()).then(setUsers);
            useEffect(() => { fetchUsers(); }, []);

            return (
                <div>
                    <div className="flex gap-4 mb-4 border-b">
                        <button onClick={()=>setTab('stats')} className={`pb-2 px-4 font-bold ${tab==='stats' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}>×“×•×—×•×ª ×”×ª×§×“××•×ª</button>
                        <button onClick={()=>setTab('users')} className={`pb-2 px-4 font-bold ${tab==='users' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}>× ×™×”×•×œ ××©×ª××©×™×</button>
                        <button onClick={()=>setTab('dedications')} className={`pb-2 px-4 font-bold ${tab==='dedications' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}>×”×§×“×©×•×ª</button>
                    </div>
                    {tab === 'stats' && <AdminStats />}
                    {tab === 'users' && <AdminUserManagement users={users} fetchUsers={fetchUsers} />}
                    {tab === 'dedications' && <AdminDedications />}
                </div>
            );
        };

        // --- ×§×•××¤×•× × ×˜×•×ª ×ª×œ××™×“ ---

        const MishnaBookView = ({ book, progress, toggle }) => {
            const chapters = useMemo(() => {
                const map = {};
                book.units.forEach(u => {
                    if(!map[u.chapterId]) map[u.chapterId] = { id: u.chapterId, title: u.chapterTitle, units: [] };
                    map[u.chapterId].units.push(u);
                });
                return Object.values(map);
            }, [book]);

            const [openChapter, setOpenChapter] = useState(null);

            return (
                <div className="space-y-2">
                    {chapters.map(chapter => {
                        const completed = chapter.units.filter(u => progress[`${book.id}_${u.id}`]).length;
                        const isFull = completed === chapter.units.length;
                        const isOpen = openChapter === chapter.id;

                        return (
                            <div key={chapter.id} className="border rounded-lg bg-white overflow-hidden">
                                <button onClick={() => setOpenChapter(isOpen?null:chapter.id)} className={`w-full flex justify-between p-3 hover:bg-gray-50 ${isFull?'bg-emerald-50 text-emerald-800':''}`}>
                                    <span className="font-bold">{chapter.title}</span>
                                    <div className="flex gap-2 text-sm text-gray-500">
                                        <span>{completed}/{chapter.units.length}</span>
                                        <span>{isOpen?'â–¼':'â—€'}</span>
                                    </div>
                                </button>
                                <div className={`chapter-content bg-slate-50 ${isOpen?'open':''}`}>
                                    <div className="p-3 grid grid-cols-3 sm:grid-cols-6 gap-2">
                                        {chapter.units.map(u => {
                                             const k = `${book.id}_${u.id}`;
                                             return <button key={u.id} onClick={()=>toggle(k)} className={`p-2 rounded border text-sm ${progress[k]?'bg-emerald-600 text-white':'bg-white'}`}>{u.label.replace('××©× ×” ','')}</button>;
                                        })}
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('student');
            const [loginData, setLoginData] = useState({username:'', password:''});
            const [loginError, setLoginError] = useState('');
            
            const [selectedTrack, setSelectedTrack] = useState(ALL_TRACKS[0]);
            const [activeSecId, setSecId] = useState(ALL_TRACKS[0].sections[0].id);
            const [activeBookId, setBookId] = useState(ALL_TRACKS[0].sections[0].books[0].id);
            const [progress, setProgress] = useState({});

            // ×˜×¢×™× ×ª × ×ª×•× ×™×
            useEffect(() => {
                if (user) fetch(`${API_URL}/api/get_progress?user_id=${user.id}`).then(r=>r.json()).then(k=>{const p={};k.forEach(x=>p[x]=true);setProgress(p)});
            }, [user]);

            // × ×™×”×•×œ ××¡×œ×•×œ ×¤×¢×™×œ
            const activeTrack = selectedTrack;
            const activeSec = activeTrack.sections.find(s=>s.id===activeSecId) || activeTrack.sections[0];
            const activeBook = activeSec.books.find(b=>b.id===activeBookId) || activeSec.books[0];

            // ×¡×˜×˜×™×¡×˜×™×§×•×ª
            const stats = useMemo(() => {
                const bookTotal = activeBook.units.length;
                const bookDone = activeBook.units.filter(u => progress[`${activeBook.id}_${u.id}`]).length;
                
                const trackPrefix = selectedTrack.id === 'gemara' ? 'gb_' : 'mb_';
                const trackTotal = selectedTrack.id === 'gemara' ? GEMARA_TOTAL : MISHNA_TOTAL;
                const trackDone = Object.keys(progress).filter(k => k.includes(trackPrefix)).length;

                return { bookTotal, bookDone, trackTotal, trackDone };
            }, [progress, activeBook, selectedTrack]);

            const changeTrack = (tid) => {
                const t = ALL_TRACKS.find(x=>x.id===tid);
                setSelectedTrack(t); setSecId(t.sections[0].id); setBookId(t.sections[0].books[0].id);
            };

            const toggleKey = (k, f=null) => {
                const ns = f!==null?f:!progress[k];
                setProgress(p=>({...p,[k]:ns}));
                fetch(`${API_URL}/api/toggle_page`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:user.id,key:k,force_state:ns})});
            };

            // ×’×¨×™×¨×”
            const [isDragging, setIsDragging] = useState(false);
            const [dragState, setDragState] = useState(null);
            const handleMD = (uid,d) => { if(activeBook.type==='pages'){ setIsDragging(true); setDragState(!d); toggleKey(`${activeBook.id}_${uid}`); }};
            const handleME = (uid) => { if(isDragging && activeBook.type==='pages') toggleKey(`${activeBook.id}_${uid}`, dragState); };
            useEffect(()=>{const u=()=>setIsDragging(false);window.addEventListener('mouseup',u);return()=>window.removeEventListener('mouseup',u)},[]);

            // ×œ×•×’×™×Ÿ
            const doLogin = () => {
                if (!window.grecaptcha) {
                    setLoginError("×©×’×™××ª ×˜×¢×™× ×ª reCAPTCHA");
                    return;
                }
                window.grecaptcha.ready(() => {
                    window.grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'login'}).then((token) => {
                         fetch(`${API_URL}/api/login`, {
                             method: 'POST',
                             headers: {'Content-Type': 'application/json'},
                             body: JSON.stringify({...loginData, recaptcha_token: token})
                         })
                         .then(r=>r.json())
                         .then(d=>{if(d.ok){setUser(d.user);setLoginError('')}else setLoginError(d.error)});
                    });
                });
            };

            // ×™×¦×™××” ×‘×˜×•×—×”
            const handleLogout = () => {
                setUser(null);
                setLoginData({username:'', password:''});
            };

            if(!user) return (
                <div className="flex flex-col min-h-screen">
                    <div className="flex-1 flex items-center justify-center bg-slate-100 p-4">
                        <div className="w-full max-w-md">
                            <DedicationsDisplay />
                            <div className="bg-white p-8 rounded-2xl shadow-xl text-center">
                                <h1 className="text-2xl font-bold mb-6 text-blue-800">××¢×¨×›×ª "×¢×¥ ×—×™×™×"</h1>
                                <input className="w-full border p-3 rounded-lg mb-3 text-right" placeholder="×©× ××©×ª××©" value={loginData.username} onChange={e=>setLoginData({...loginData,username:e.target.value})} onKeyDown={e=>e.key==='Enter'&&doLogin()}/>
                                <input className="w-full border p-3 rounded-lg mb-3 text-right" type="password" placeholder="×¡×™×¡××”" value={loginData.password} onChange={e=>setLoginData({...loginData,password:e.target.value})} onKeyDown={e=>e.key==='Enter'&&doLogin()}/>
                                <button onClick={doLogin} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
                                {loginError && <p className="text-red-500 mt-4 text-sm">{loginError}</p>}
                                <div className="text-xs text-gray-400 mt-4">××•×’×Ÿ ×¢×œ ×™×“×™ reCAPTCHA <br/>
                                    <a href="https://policies.google.com/privacy" target="_blank" className="underline">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a> ×•
                                    <a href="https://policies.google.com/terms" target="_blank" className="underline">×ª× ××™ ×©×™××•×©</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <footer className="bg-slate-800 text-slate-400 text-center py-4 text-xs">×¤×•×ª×— ×¢×œ ×™×“×™ OrelAI <a href="mailto:ubriga@gmail.com" className="underline">ubriga@gmail.com</a></footer>
                </div>
            );

            return (
                <div className="flex flex-col flex-1">
                    <header className="bg-white border-b sticky top-0 z-30 px-4 py-3 shadow-sm flex justify-between items-center">
                        <div><span className="font-bold text-lg text-blue-900 block">×¢×¥ ×—×™×™× LMS</span><span className="text-[10px] text-gray-400">by OrelAI</span></div>
                        <nav className="flex items-center gap-4">
                            {user.role === 'admin' && <button onClick={()=>setView(view==='admin'?'student':'admin')} className="text-sm font-bold text-blue-600">{view==='admin'?'×—×–×¨×” ×œ×œ×•××“':'×××©×§ ×× ×”×œ'}</button>}
                            <span className="text-xs font-bold bg-slate-100 px-2 py-1 rounded">{user.name}</span>
                            <button onClick={handleLogout} className="text-red-500" title="×™×¦×™××”">ğŸšª</button>
                        </nav>
                    </header>
                    <div className="bg-slate-50 py-4">
                        <DedicationsDisplay />
                    </div>
                    <main className="max-w-7xl mx-auto p-4 w-full flex-1">
                        {view === 'admin' ? <AdminPanel /> : (
                            <div className="space-y-6">
                                <div className="flex justify-center gap-4">
                                    {ALL_TRACKS.map(t => <button key={t.id} onClick={()=>changeTrack(t.id)} className={`px-6 py-2 rounded-full font-bold transition ${selectedTrack.id===t.id?'bg-blue-600 text-white shadow-lg':'bg-white text-gray-600 border'}`}>{t.title}</button>)}
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-white p-5 rounded-xl border shadow-sm">
                                        <div className="text-sm text-gray-500 mb-1">×”×ª×§×“××•×ª ×‘{activeBook.title}</div>
                                        <div className="text-2xl font-bold text-blue-600">{stats.bookDone} / {stats.bookTotal}</div>
                                        <div className="w-full bg-gray-200 h-2 rounded-full mt-2"><div className="bg-blue-600 h-2 rounded-full" style={{width:`${(stats.bookDone/stats.bookTotal)*100}%`}}></div></div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl border shadow-sm">
                                        <div className="text-sm text-gray-500 mb-1">×¡×™×•× ×”×©"×¡ ({selectedTrack.title})</div>
                                        <div className="text-2xl font-bold text-amber-600">{stats.trackDone} / {stats.trackTotal}</div>
                                        <div className="w-full bg-gray-200 h-2 rounded-full mt-2"><div className="bg-amber-500 h-2 rounded-full" style={{width:`${(stats.trackDone/stats.trackTotal)*100}%`}}></div></div>
                                    </div>
                                </div>

                                <div className="bg-white p-4 rounded-xl border shadow-sm flex flex-col sm:flex-row gap-3 sticky top-16 z-20">
                                    <select className="border p-2 rounded-lg flex-1 bg-slate-50" value={activeSecId} onChange={e=>{const s=activeTrack.sections.find(x=>x.id===e.target.value);setSecId(s.id);setBookId(s.books[0].id)}}>{activeTrack.sections.map(s=><option key={s.id} value={s.id}>{s.title}</option>)}</select>
                                    <select className="border p-2 rounded-lg flex-1 bg-slate-50" value={activeBookId} onChange={e=>setBookId(e.target.value)}>{activeSec.books.map(b=><option key={b.id} value={b.id}>{b.title}</option>)}</select>
                                </div>

                                {activeBook.type === 'mishna' ? (
                                    <MishnaBookView book={activeBook} progress={progress} toggle={toggleKey} />
                                ) : (
                                    <div className="bg-white p-6 rounded-xl border shadow-sm">
                                        <div className="flex justify-between mb-4"><h2 className="font-bold text-lg">{activeBook.title}</h2><button onClick={()=>{if(confirm("×œ×¡××Ÿ ××ª ×›×œ ×”××¡×›×ª?"))activeBook.units.forEach(u=>toggleKey(`${activeBook.id}_${u.id}`,true))}} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">âœ… ×¡××Ÿ ×”×›×œ</button></div>
                                        <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3">
                                            {activeBook.units.map(u => {
                                                const k = `${activeBook.id}_${u.id}`; const d = progress[k];
                                                return <button key={u.id} onMouseDown={()=>handleMD(u.id,d)} onMouseEnter={()=>handleME(u.id)} className={`page-btn p-3 rounded-lg border text-sm font-medium ${d?'bg-blue-600 text-white shadow-md':'bg-slate-50 text-gray-600'}`}>{u.label} {d&&"âœ“"}</button>;
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    <footer className="bg-slate-800 text-slate-400 text-center py-4 text-xs">×¤×•×ª×— ×¢×œ ×™×“×™ OrelAI <a href="mailto:ubriga@gmail.com" className="underline">ubriga@gmail.com</a></footer>
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>